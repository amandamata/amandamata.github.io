<!DOCTYPE html>


<html lang="en" data-theme="">
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>Implementing a sqs publisher and consumer using dotnet - amandamata</title>

<meta name="description" content="In this post, I pass an introduction to a queue and how to use it. Now I gonna explain how to implement an sqs consumer and publisher using c# dotnet. #### SQS What is SQS?
SQS (Simple Queue Service) is an Amazon service that lets you send, store, and receive messages between software components at any volume, without losing messages or requiring other services to be available.
The best part is free, actually to pay for this service you gonna need to send over 1 million requests per month then amazon is going to bill you.">





<link rel="icon" type="image/x-icon" href="https://amandamata.github.io/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://amandamata.github.io/favicon.png">








    



<style>
  body {
    visibility: hidden;
    opacity: 0;
  }
</style>

<noscript>
  <style>
    body {
      visibility: visible;
      opacity: 1;
    }
  </style>
</noscript>




    





    
    
        
    
    

    
        <link rel="stylesheet" href="/css/style.min.184a655c5ad8596648622468e6696abf0cf0a2cf8266df17b4f7a36fe9c97551.css" integrity="sha256-GEplXFrYWWZIYiRo5mlqvwzwos&#43;CZt8XtPejb&#43;nJdVE=">
    





    





    
    
        
    
    

    
        <link rel="stylesheet" href="/css/style.min.c4c04b3ef88e3d619ad4c7ee5e03048422bc55c4fefdc1f07657c1133670aa22.css" integrity="sha256-xMBLPviOPWGa1MfuXgMEhCK8VcT&#43;/cHwdlfBEzZwqiI=">
    





    





    
    
        
    
    

    
        <link rel="stylesheet" href="/css/style.min.21c5d8fe0a79d623b0adc1ce4bd4f6dd2c05cd939c9aaaa966ba7186b1464f4d.css" integrity="sha256-IcXY/gp51iOwrcHOS9T23SwFzZOcmqqpZrpxhrFGT00=">
    












    

    





    
    
        
    
    

    
        <script src="/js/script.min.08f04d96386c73c9bf4d160333f8f448c05a6e01c06770542ee0e013954ce930.js" type="text/javascript" charset="utf-8" integrity="sha256-CPBNljhsc8m/TRYDM/j0SMBabgHAZ3BULuDgE5VM6TA="></script>
    



















    
</head>
<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header">
            
                <div class="header-top">
    <div class="header-top-left">
        <h1 class="site-title noselect">
    <a href="/">amandamata</a>
</h1>

        







    
        <div class="theme-switcher">
            <span class="inline-svg">

    


    
    
    
    
    

    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-sun-high"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z" /><path d="M6.343 17.657l-1.414 1.414" /><path d="M6.343 6.343l-1.414 -1.414" /><path d="M17.657 6.343l1.414 -1.414" /><path d="M17.657 17.657l1.414 1.414" /><path d="M4 12h-2" /><path d="M12 4v-2" /><path d="M20 12h2" /><path d="M12 20v2" /></svg>


</span>

        </div>
    

    <script>
        const STORAGE_KEY = 'user-color-scheme'
        const defaultTheme = "light"

        let currentTheme
        let switchButton
        let autoDefinedScheme = window.matchMedia('(prefers-color-scheme: dark)')

        function switchTheme(e) {
            currentTheme = (currentTheme === 'dark') ? 'light' : 'dark';
            if (localStorage) localStorage.setItem(STORAGE_KEY, currentTheme);
            document.documentElement.setAttribute('data-theme', currentTheme);
            changeGiscusTheme(currentTheme);
            document.body.dispatchEvent(new CustomEvent(currentTheme + "-theme-set"));
        }

        const autoChangeScheme = e => {
            currentTheme = e.matches ? 'dark' : 'light'
            document.documentElement.setAttribute('data-theme', currentTheme);
            changeGiscusTheme(currentTheme);
            document.body.dispatchEvent(new CustomEvent(currentTheme + "-theme-set"));
        }

        document.addEventListener('DOMContentLoaded', function () {
            switchButton = document.querySelector('.theme-switcher')
            currentTheme = detectCurrentScheme()

            if (currentTheme === 'auto') {
                autoChangeScheme(autoDefinedScheme);
                autoDefinedScheme.addListener(autoChangeScheme);
            } else {
                document.documentElement.setAttribute('data-theme', currentTheme)
            }

            if (switchButton) {
                switchButton.addEventListener('click', switchTheme, false)
            }

            showContent();
        })

        function detectCurrentScheme() {
            if (localStorage !== null && localStorage.getItem(STORAGE_KEY)) {
                return localStorage.getItem(STORAGE_KEY)
            }
            if (defaultTheme) {
                return defaultTheme
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function showContent() {
            document.body.style.visibility = 'visible';
            document.body.style.opacity = 1;
        }

        function changeGiscusTheme (theme) {
            function sendMessage(message) {
              const iframe = document.querySelector('iframe.giscus-frame');
              if (!iframe) return;
              iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
            }

            sendMessage({
              setConfig: {
                theme: theme
              }
            });
        }
    </script>


        <ul class="social-icons noselect">







    <li>
            <a href="/index.xml" title="RSS" rel="me">
            <span class="inline-svg">

    


    
    
    
    
    

    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M4 4a16 16 0 0 1 16 16" /><path d="M4 11a9 9 0 0 1 9 9" /></svg>


</span>

            </a>
        </li>
    

</ul>

    </div>
    <div class="header-top-right">

    </div>
</div>


    <nav></nav>








            
        </header>
        <main id="main" tabindex="-1">
            
    

    <article class="post h-entry">
        <div class="post-header">
            <header>
                <h1 class="p-name post-title">Implementing a sqs publisher and consumer using dotnet</h1>
                
    
    <span>
        <ul class="post-translations">
            
                
                    <li>
                        EN
                    </li>
                
            
                
                    <li>
                        <a href="/pt-pt/post/queue-csharp-sqs/">PT-PT</a>
                    </li>
                
            
        </ul>
    </span>


            </header>
            



<div class="post-info noselect">
    
        <div class="post-date dt-published">
            <time datetime="2023-02-22">2023-02-22</time>
            
        </div>
    

    <a class="post-hidden-url u-url" href="/post/queue-csharp-sqs/">/post/queue-csharp-sqs/</a>
    <a href="https://amandamata.github.io" class="p-name p-author post-hidden-author h-card" rel="me"></a>


    <div class="post-taxonomies">
        
        
            <ul class="post-tags">
                
                    
                    <li><a href="/tags/queue/">#queue</a></li>
                
                    
                    <li><a href="/tags/sqs/">#sqs</a></li>
                
                    
                    <li><a href="/tags/dotnet/">#dotnet</a></li>
                
                    
                    <li><a href="/tags/aws/">#aws</a></li>
                
            </ul>
        
        
    </div>
</div>

        </div>
        

  
  




  
  
  
  <details class="toc noselect">
    <summary>Table of Contents</summary>
    <div class="inner"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav></div>
  </details>
  



<script>
  var toc = document.querySelector(".toc");
  if (toc) {
    toc.addEventListener("click", function () {
      if (event.target.tagName !== "A") {
        event.preventDefault();
        if (this.open) {
          this.open = false;
          this.classList.remove("expanded");
        } else {
          this.open = true;
          this.classList.add("expanded");
        }
      }
    });
  }
</script>

        <div class="content e-content">
            <p>In this <a href="/queue">post</a>, I pass an introduction to a queue and how to use it. Now I gonna explain how to implement an sqs consumer and publisher using c# dotnet.
<br/><br/></p>
<h5 id="sqs" >
<div>
    <a href="#sqs">
        ####
    </a>
    SQS
</div>
</h5>
<p>What is SQS?</p>
<p>SQS (Simple Queue Service) is an Amazon service that lets you send, store, and receive messages between software components at any volume, without losing messages or requiring other services to be available.</p>
<p>The best part is free, actually to pay for this service you gonna need to send over 1 million requests per month then amazon is going to bill you.</p>
<p>To start, it&rsquo;s necessary to create an account in <a href="https://aws.amazon.com/">aws</a> and go to <a href="https://console.aws.amazon.com">console</a>.</p>
<p>In the console area, type SQS in search and enter the first option Simple Queue Service.
Click on Create queue, add a name to the queue and go to the end of the page and click Create queue. You can change the default values, but for now, all the settings are ok.
<br/><br/></p>
<h5 id="aws-command-line-interface" >
<div>
    <a href="#aws-command-line-interface">
        ####
    </a>
    AWS Command Line Interface
</div>
</h5>
<p>The AWS Command Line Interface allows us to make changes directly from the console without the need to access the AWS console.
For example, if we need to list the buckets:</p>
<pre tabindex="0"><code>aws s3api list-buckets
</code></pre><p>To be able to do that we need to install the cli, the tutorial for Windows, Linux, and macOS is <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">here</a>.</p>
<p>After the installation, it&rsquo;s necessary to authenticate your machine against aws.</p>
<p>In aws console, click in your name and go to Security Credentials, there, you need to create an Access Key.</p>
<p>In your console you gonna type:</p>
<pre tabindex="0"><code>aws configure
</code></pre><p>Then pass your access key and token when requested.</p>
<blockquote>
<p>Important, in the aws console you have a region, mine is us-east-1, you can see yours by checking on url: https://<em><strong>us-east-1</strong></em>.console.aws.amazon.com/</p>
</blockquote>
<p>That region needs to be passed during aws configuration, to be able to access aws features locally.</p>
<p>After the configuration, you&rsquo;re gonna able to execute the list buckets.</p>
<pre tabindex="0"><code>aws s3api list-buckets
</code></pre><br/>
<h5 id="publisher" >
<div>
    <a href="#publisher">
        ####
    </a>
    Publisher
</div>
</h5>
<p>What is a publisher?</p>
<p>A publisher it&rsquo;s a service that gonna get the information that something changes and sends to the queue a request.
In the example used in the queue post, the publisher is inside the API, and after a new user was created the request was sent to the queue.</p>
<p>So with everything configured, it&rsquo;s time to create the publisher.</p>
<p>In order to simplify, the example here it&rsquo;s gonna be only the publisher, then you can take the implementation and use it in your API.</p>
<p>We&rsquo;re gonna use a Console App</p>
<p>Create a new folder:</p>
<pre tabindex="0"><code>mkdir publisher
</code></pre><p>Go inside the folder:</p>
<pre tabindex="0"><code>cd publisher
</code></pre><p>Create the project:</p>
<pre tabindex="0"><code>dotnet new console
</code></pre><p>It&rsquo;s necessary a model:</p>
<pre tabindex="0"><code>public class CustomerCreated
{
  public Guid Id { get; init; }
  public string FullName { get; init; }
  public string Email { get; init; }
  public DateTime DateOfBirth { get; init; }
}
</code></pre><p>And install the <a href="https://www.nuget.org/packages/AWSSDK.SQS">AWS SDK</a></p>
<pre tabindex="0"><code>dotnet add package AWSSDK.SQS --version 3.7.100.78
</code></pre><p>After that, in the Program we need to create a request and send it:</p>
<pre tabindex="0"><code>using System.Text.Json;
using Amazon.SQS;
using Amazon.SQS.Model;

var sqsCLient = new AmazonSQSClient();

var customer = new CustomerCreated
{
  Id = Guid.NewGuid(),
  FullName = &#34;Amanda Mata&#34;,
  Email = &#34;email@email.com&#34;,
  DateOfBirth = new DateTime(1996, 06, 18)
};

var queueUrlResponse = await sqsCLient.GetQueueUrlAsync(&#34;customers&#34;);

var sendMessageRequest = new SendMessageRequest
{
  QueueUrl = queueUrlResponse.QueueUrl, 
  MessageBody = JsonSerializer.Serialize(customer),
  MessageAttributes = new Dictionary&lt;string, MessageAttributeValue&gt;
  {
      {
          &#34;MessageType&#34;, new MessageAttributeValue
          {
              DataType = &#34;String&#34;, 
              StringValue = nameof(CustomerCreated)
          }
      }
  }
};

var response = await sqsCLient.SendMessageAsync(sendMessageRequest);

Console.WriteLine();
</code></pre><blockquote>
<p>In the sqsCLient.GetQueueUrlAsync(&ldquo;customers&rdquo;) I used &ldquo;customers&rdquo; cuz that is the name of my queue</p>
</blockquote>
<br/>
<h5 id="consumer" >
<div>
    <a href="#consumer">
        ####
    </a>
    Consumer
</div>
</h5>
<p>What it&rsquo;s a consumer?</p>
<p>A consumer it&rsquo;s the service that will be listening the queue.</p>
<p>We&rsquo;re gonna use a Console App</p>
<p>Create a new folder:</p>
<pre tabindex="0"><code>mkdir consumer
</code></pre><p>Go inside the folder:</p>
<pre tabindex="0"><code>cd consumer
</code></pre><p>Create the project:</p>
<pre tabindex="0"><code>dotnet new console
</code></pre><p>It&rsquo;s necessary a model:</p>
<pre tabindex="0"><code>public class CustomerCreated
{
  public Guid Id { get; init; }
  public string FullName { get; init; }
  public string Email { get; init; }
  public DateTime DateOfBirth { get; init; }
}
</code></pre><p>And install the <a href="https://www.nuget.org/packages/AWSSDK.SQS">AWS SDK</a></p>
<pre tabindex="0"><code>dotnet add package AWSSDK.SQS --version 3.7.100.78
</code></pre><p>After that, in the Program we need to receive the request:</p>
<pre tabindex="0"><code>using Amazon.SQS;
using Amazon.SQS.Model;
	 
var cts = new CancellationTokenSource();
var sqsCLient = new AmazonSQSClient();
var queueUrlResponse = await sqsCLient.GetQueueUrlAsync(&#34;customers&#34;);
var receiveMessageRequest = new ReceiveMessageRequest
{
  QueueUrl = queueUrlResponse.QueueUrl,
  AttributeNames = new List&lt;string&gt;{ &#34;All&#34; },
  MessageAttributeNames = new List&lt;string&gt;{ &#34;All&#34; }
};
	 
while(!cts.IsCancellationRequested)
{
  var response = await sqsCLient.ReceiveMessageAsync(receiveMessageRequest, cts.Token);
  response.Messages.ForEach(async message =&gt; {
    Console.WriteLine($&#34;Message Id: { message.MessageId }&#34;);
    Console.WriteLine($&#34;Message Body: { message.Body }&#34;);
    await sqsCLient.DeleteMessageAsync(queueUrlResponse.QueueUrl, message.ReceiptHandle);
  });

  await Task.Delay(3000);
}

Console.WriteLine();
</code></pre><br/>
<p>Now the publisher and the consumer It&rsquo;s created, you can pull for messages inside the aws console, but just running the publisher and the consumer you&rsquo;re gonna be able to see the sending and receiving messages.</p>
<hr>
<p>I create this post for my studying purpose, the learnings I posted here were driven by the <a href="https://nickchapsas.com/p/cloud-fundamentals-aws-services-for-c-developers">Cloud Fundamentals: AWS Services for C# Developers course</a>.</p>

        </div>

    </article>

    
    

    
        
        
            <h3 class="read-next-title noselect">Read next</h3>
            <ul class="read-next-posts noselect">
                
                <li><a href="/post/curly-brace/">Curly braces on new line in vscode</a></li>
                
                <li><a href="/post/queue/">Application of queue</a></li>
                
            </ul>
        
    

    

    
        









    

    

    

        </main>
        
            <footer class="common-footer noselect">
    
    
        <ul class="language-select">
    
    
    

    
        
            <li><a href="/pt-pt/post/queue-csharp-sqs/">pt</a></li>
        
    
        
            <li>en</li>
        
    
</ul>

    

    <div class="common-footer-bottom">
        

        <div style="display: flex; align-items: center; gap:8px">
            Â© amanda, 2024
            
        </div>
        <div style="display:flex;align-items: center">
            
            
            
            
            
            
        </div>
        <div>
            Powered by <a target="_blank" rel="noopener noreferrer" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" rel="noopener noreferrer" href="https://github.com/Junyi-99/hugo-theme-anubis2">Anubis2</a>.<br>
            

        </div>
    </div>

    <p class="h-card vcard">

    <a href=https://amandamata.github.io class="p-name u-url url fn" rel="me"></a>

    

    
</p>

</footer>

        
    </div>
</body>
</html>
